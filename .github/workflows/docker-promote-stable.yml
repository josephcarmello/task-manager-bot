name: Promote Image to Stable

on:
  workflow_dispatch:
    inputs:
      source_tag:
        description: "Tag to promote (e.g. 123456789-1 or sha-a1b2c3d4e5f6)"
        required: true

jobs:
  promote:
    runs-on: self-hosted

    env:
      REGISTRY: registry.islocal.dev
      IMAGE_NAME: task-manager-bot

    steps:
      - name: Promote image to stable
        run: |
          SRC=${REGISTRY}/${IMAGE_NAME}:${{ github.event.inputs.source_tag }}
          DST=${REGISTRY}/${IMAGE_NAME}:stable

          docker pull $SRC
          docker tag  $SRC $DST
          docker push $DST
          docker rmi -f $SRC $DST || true
